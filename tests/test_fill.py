#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
test_tstoolbox
----------------------------------

Tests for `tstoolbox` module.
"""

from unittest import TestCase
import sys
try:
    from cStringIO import StringIO
except:
    from io import StringIO

import tstoolbox


def capture(func, *args, **kwds):
    sys.stdout = StringIO()      # capture output
    out = func(*args, **kwds)
    out = sys.stdout.getvalue()  # release output
    return out


class TestFill(TestCase):

    def test_fill_ffill(self):
        out = capture(tstoolbox.fill, input_ts='tests/test_fill_01.csv')
        self.maxDiff = None
        self.assertEqual(out,
"""Datetime, Value_fill
2011-01-01 00:00:00 ,  2.0
2011-01-01 01:00:00 ,  2.0
2011-01-01 02:00:00 ,  2.0
2011-01-01 03:00:00 ,  2.0
2011-01-01 04:00:00 ,  2.0
2011-01-01 05:00:00 ,  2.0
2011-01-01 06:00:00 ,  2.0
2011-01-01 07:00:00 ,  2.0
2011-01-01 08:00:00 ,  2.0
2011-01-01 09:00:00 ,  3.0
2011-01-01 10:00:00 ,  3.0
2011-01-01 11:00:00 ,  3.0
2011-01-01 12:00:00 ,  3.0
2011-01-01 13:00:00 ,  9.0
2011-01-01 14:00:00 ,  2.0
2011-01-01 15:00:00 ,  2.0
2011-01-01 16:00:00 ,  2.0
2011-01-01 17:00:00 ,  2.0
2011-01-01 18:00:00 ,  2.0
2011-01-01 19:00:00 ,  2.0
2011-01-01 20:00:00 ,  2.0
2011-01-01 21:00:00 ,  2.0
2011-01-01 22:00:00 ,  2.0
2011-01-01 23:00:00 ,  2.0
2011-01-02 00:00:00 ,  2.0
2011-01-02 01:00:00 ,  2.0
""")

    def test_fill_bfill(self):
        out = capture(tstoolbox.fill, method='bfill', input_ts='tests/test_fill_01.csv')
        self.maxDiff = None
        self.assertEqual(out,
"""Datetime, Value_fill
2011-01-01 00:00:00 ,  2.0
2011-01-01 01:00:00 ,  2.0
2011-01-01 02:00:00 ,  2.0
2011-01-01 03:00:00 ,  2.0
2011-01-01 04:00:00 ,  2.0
2011-01-01 05:00:00 ,  2.0
2011-01-01 06:00:00 ,  2.0
2011-01-01 07:00:00 ,  2.0
2011-01-01 08:00:00 ,  2.0
2011-01-01 09:00:00 ,  3.0
2011-01-01 10:00:00 ,  9.0
2011-01-01 11:00:00 ,  9.0
2011-01-01 12:00:00 ,  9.0
2011-01-01 13:00:00 ,  9.0
2011-01-01 14:00:00 ,  2.0
2011-01-01 15:00:00 ,  2.0
2011-01-01 16:00:00 ,  2.0
2011-01-01 17:00:00 ,  2.0
2011-01-01 18:00:00 ,  2.0
2011-01-01 19:00:00 ,  2.0
2011-01-01 20:00:00 ,  2.0
2011-01-01 21:00:00 ,  2.0
2011-01-01 22:00:00 ,  2.0
2011-01-01 23:00:00 ,  2.0
2011-01-02 00:00:00 ,  2.0
2011-01-02 01:00:00 ,  2.0
""")

    def test_fill_linear(self):
        out = capture(tstoolbox.fill, method='linear', input_ts='tests/test_fill_01.csv')
        self.maxDiff = None
        self.assertEqual(out,
"""Datetime, Value_fill
2011-01-01 00:00:00 ,  2.0
2011-01-01 01:00:00 ,  2.0
2011-01-01 02:00:00 ,  2.0
2011-01-01 03:00:00 ,  2.0
2011-01-01 04:00:00 ,  2.0
2011-01-01 05:00:00 ,  2.0
2011-01-01 06:00:00 ,  2.0
2011-01-01 07:00:00 ,  2.0
2011-01-01 08:00:00 ,  2.0
2011-01-01 09:00:00 ,  3.0
2011-01-01 10:00:00 ,  4.5
2011-01-01 11:00:00 ,  6.0
2011-01-01 12:00:00 ,  7.5
2011-01-01 13:00:00 ,  9.0
2011-01-01 14:00:00 ,  2.0
2011-01-01 15:00:00 ,  2.0
2011-01-01 16:00:00 ,  2.0
2011-01-01 17:00:00 ,  2.0
2011-01-01 18:00:00 ,  2.0
2011-01-01 19:00:00 ,  2.0
2011-01-01 20:00:00 ,  2.0
2011-01-01 21:00:00 ,  2.0
2011-01-01 22:00:00 ,  2.0
2011-01-01 23:00:00 ,  2.0
2011-01-02 00:00:00 ,  2.0
2011-01-02 01:00:00 ,  2.0
""")

    def test_fill_nearest(self):
        out = capture(tstoolbox.fill, method='nearest', input_ts='tests/test_fill_01.csv')
        self.maxDiff = None
        self.assertEqual(out,
"""Datetime, Value_fill
2011-01-01 00:00:00 ,  2.0
2011-01-01 01:00:00 ,  2.0
2011-01-01 02:00:00 ,  2.0
2011-01-01 03:00:00 ,  2.0
2011-01-01 04:00:00 ,  2.0
2011-01-01 05:00:00 ,  2.0
2011-01-01 06:00:00 ,  2.0
2011-01-01 07:00:00 ,  2.0
2011-01-01 08:00:00 ,  2.0
2011-01-01 09:00:00 ,  3.0
2011-01-01 10:00:00 ,  3.0
2011-01-01 11:00:00 ,  3.0
2011-01-01 12:00:00 ,  9.0
2011-01-01 13:00:00 ,  9.0
2011-01-01 14:00:00 ,  2.0
2011-01-01 15:00:00 ,  2.0
2011-01-01 16:00:00 ,  2.0
2011-01-01 17:00:00 ,  2.0
2011-01-01 18:00:00 ,  2.0
2011-01-01 19:00:00 ,  2.0
2011-01-01 20:00:00 ,  2.0
2011-01-01 21:00:00 ,  2.0
2011-01-01 22:00:00 ,  2.0
2011-01-01 23:00:00 ,  2.0
2011-01-02 00:00:00 ,  2.0
2011-01-02 01:00:00 ,  2.0
""")

    def test_fill_mean(self):
        out = capture(tstoolbox.fill, method='mean', input_ts='tests/test_fill_01.csv')
        self.maxDiff = None
        self.assertEqual(out,
"""Datetime, Value_fill
2011-01-01 00:00:00 ,  2.0
2011-01-01 01:00:00 ,  2.42105263158
2011-01-01 02:00:00 ,  2.0
2011-01-01 03:00:00 ,  2.0
2011-01-01 04:00:00 ,  2.0
2011-01-01 05:00:00 ,  2.0
2011-01-01 06:00:00 ,  2.0
2011-01-01 07:00:00 ,  2.0
2011-01-01 08:00:00 ,  2.0
2011-01-01 09:00:00 ,  3.0
2011-01-01 10:00:00 ,  2.42105263158
2011-01-01 11:00:00 ,  2.42105263158
2011-01-01 12:00:00 ,  2.42105263158
2011-01-01 13:00:00 ,  9.0
2011-01-01 14:00:00 ,  2.0
2011-01-01 15:00:00 ,  2.0
2011-01-01 16:00:00 ,  2.42105263158
2011-01-01 17:00:00 ,  2.0
2011-01-01 18:00:00 ,  2.0
2011-01-01 19:00:00 ,  2.0
2011-01-01 20:00:00 ,  2.0
2011-01-01 21:00:00 ,  2.0
2011-01-01 22:00:00 ,  2.42105263158
2011-01-01 23:00:00 ,  2.42105263158
2011-01-02 00:00:00 ,  2.0
2011-01-02 01:00:00 ,  2.0
""")
